<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site da Empatia</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Lora:ital,wght@0,400..700;1,400..700&family=Scada:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <style>
    body {
      background: url('https://images.unsplash.com/photo-1428908728789-d2de25dbd4e2?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center fixed;
      background-size: cover;
      color: #EAEAEA;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      width: 100vw;
      overflow-x: hidden;
    }

    main {
      max-width: 600px;
      width: 100%;
      padding: 20px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .card {
      background-color: rgba(250, 247, 255, 0.199);
      padding: 32px 26px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      margin: 0 auto 20px auto;
      backdrop-filter: blur(10px);
      color: #444444;
      width: 100%;
      max-width: 440px;
      box-sizing: border-box;
    }

    textarea {
      width: 100%;
      height: 90px;
      padding: 12px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #cccccc;
      resize: none;
      margin-bottom: 10px;
      box-sizing: border-box;
      background: rgba(255, 255, 255, 0);
      color: #222222;
      outline: none;
    }
    
    button {
      background-color: transparent;
      color: #2F3542;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: bold;
    }

    button:hover {
      background-color: rgb(197, 237, 247);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    h2 {
      font-family: 'Lora', 'Lato', 'Scada', sans-serif;
      color: #424242;
    }

    .loading {
      text-align: center;
      color: #666;
      font-style: italic;
    }

    .status {
      text-align: center;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .status.success {
      background: rgba(76, 175, 80, 0.1);
      color: #4CAF50;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .status.error {
      background: rgba(244, 67, 54, 0.1);
      color: #f44336;
      border: 1px solid rgba(244, 67, 54, 0.3);
    }

    @media (max-width: 600px) {
      html, body {
        width: 100vw;
        min-width: 0;
        max-width: 100vw;
        overflow-x: hidden;
      }
      main {
        max-width: 100vw;
        width: 100vw;
        padding: 8px 0;
        margin: 0;
      }
      .card {
        max-width: 98vw;
        width: 98vw;
        padding: 18px 2vw;
        font-size: 1em;
        margin-left: auto;
        margin-right: auto;
        box-sizing: border-box;
      }
      textarea {
        height: 70px;
        font-size: 1em;
        padding: 8px;
        box-sizing: border-box;
      }
      h2 {
        font-size: 1.1em;
      }
      #notificacao {
        font-size: 1em !important;
        padding: 10px 2vw !important;
        width: 90vw;
        min-width: unset;
        max-width: 95vw;
        box-sizing: border-box;
      }
    }
  </style>
</head>
<body>
  <main>
    <!-- Status de conexão -->
    <div id="status" class="status" style="display:none;"></div>

    <!-- Caixa de mensagem -->
    <div class="card">
      <h2>Escreva a sua mensagem de empatia:</h2>
      <textarea id="mensagem" placeholder="Fulano, você faz a diferença!"></textarea>
      <button id="btnPostar" onclick="postarMensagem()">Postar</button>
    </div>

    <!-- Notificação -->
    <div id="notificacao" style="display:none;position:fixed;top:30px;left:50%;transform:translateX(-50%);
    background:rgba(255,255,255,0.18);
    color:#444;
    padding:14px 32px;
    border-radius:8px;z-index:1000;
    font-family:'Lato',sans-serif;
    font-size:1.1em;
    box-shadow:0 2px 8px rgba(0,0,0,0.18);">
    </div>

    <!-- Feed -->
    <div id="feed">
      <div class="loading">Conectando...</div>
    </div>
  </main>

  <!-- Firebase SDK v8 (mais estável) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  
  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA0ffYLQX2uu9srkaMONuxXKaQnSQXADAw",
      authDomain: "siteincrivelparaescola.firebaseapp.com",
      projectId: "siteincrivelparaescola",
      storageBucket: "siteincrivelparaescola.firebasestorage.app",
      messagingSenderId: "665272869884",
      appId: "1:665272869884:web:9f12bee84fc4d8c9f54879"
    };

    let db;
    let isConnected = false;

    function mostrarStatus(msg, tipo = 'error') {
      const status = document.getElementById('status');
      status.textContent = msg;
      status.className = `status ${tipo}`;
      status.style.display = 'block';
      
      if (tipo === 'success') {
        setTimeout(() => {
          status.style.display = 'none';
        }, 3000);
      }
    }

    function mostrarNotificacao(msg) {
      const n = document.getElementById('notificacao');
      n.innerText = msg;
      n.style.display = 'block';
      setTimeout(() => {
        n.style.display = 'none';
      }, 1800);
    }

    function renderizarFeed(mensagens) {
      const feed = document.getElementById('feed');
      feed.innerHTML = '';
      
      if (mensagens.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.className = 'card';
        emptyMsg.innerHTML = '<em>Ainda não há mensagens. Seja o primeiro a postar!</em>';
        feed.appendChild(emptyMsg);
        return;
      }

      mensagens.forEach(msg => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerText = msg.texto;
        feed.appendChild(card);
      });
    }

    async function postarMensagem() {
      const textarea = document.getElementById('mensagem');
      const btnPostar = document.getElementById('btnPostar');
      const texto = textarea.value.trim();
      
      if (!texto) {
        mostrarNotificacao('Por favor, escreva uma mensagem!');
        return;
      }

      if (!isConnected) {
        mostrarNotificacao('Aguarde, conectando...');
        return;
      }

      try {
        btnPostar.disabled = true;
        btnPostar.innerText = 'Postando...';

        await db.collection('mensagens').add({
          texto: texto,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        textarea.value = '';
        mostrarNotificacao('Postagem bem-sucedida!');

      } catch (error) {
        console.error('Erro ao postar:', error);
        mostrarNotificacao('Erro ao postar: ' + error.message);
        mostrarStatus('Erro: ' + error.message, 'error');
      } finally {
        btnPostar.disabled = false;
        btnPostar.innerText = 'Postar';
      }
    }

    function carregarMensagens() {
      db.collection('mensagens')
        .orderBy('timestamp', 'desc')
        .onSnapshot((querySnapshot) => {
          const mensagens = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            mensagens.push({
              id: doc.id,
              texto: data.texto,
              timestamp: data.timestamp
            });
          });
          renderizarFeed(mensagens);
          
          if (!isConnected) {
            isConnected = true;
            mostrarStatus('✅ Conectado ao site da empatia!', 'success');
          }
        }, (error) => {
          console.error('Erro ao carregar mensagens:', error);
          mostrarStatus('Erro ao conectar: ' + error.message, 'error');
          document.getElementById('feed').innerHTML = '<div class="card"><em>Erro ao carregar mensagens: ' + error.message + '</em></div>';
        });
    }

    // Inicializar Firebase
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      carregarMensagens();
    } catch (error) {
      console.error('Erro ao inicializar Firebase:', error);
      mostrarStatus('Erro ao inicializar Firebase: ' + error.message, 'error');
    }
  </script>
</body>
</html>

